# Coder Double Separation Protocol (CDSP)

## 0. 核心哲学
将代码修改拆分为 **“逻辑决策”** 与 **“物理实施”**。通过清空上下文后的二次启动，彻底消除 AI 在长对话中的注意力漂移与代码异化。

---

## 1. 阶段 I：评估与规划 (Evaluator/Planner)
**目标**：理解全局，制定“手术方案”，而非写出代码。

- **输入要素**：
    - `Goal`: 修改意图与架构约束。
    - **广域上下文**：相关联的多个文件片段、API 文档、`assistant.md` 进度。
- **任务重点**：
    - **依赖分析**：识别改动是否破坏现有的 Trait、生命周期或调用链。
    - **复用审计**：强制检索项目中已有的工具函数，严禁重复造轮子。
    - **改动锚定**：精准锁定需要修改的行号区间。
- **产出**：一份结构化的 **Implementation Spec**（实施规格书）。

---

## 2. 阶段 II：生成与缝合 (Generator/Surgeon)
**目标**：在“真空环境”下执行精准的代码切割与替换。

- **注入逻辑**：**彻底清空阶段 I 的思维链与原始讨论**。
- **输入要素**：
    - **最小上下文**：仅提供阶段 I 确定的目标文件片段。
    - **行动指令**：阶段 I 产出的 Implementation Spec。
- **任务重点**：
    - **原子修改**：仅针对指定行号进行 Diff 生成。
    - **格式保真**：严格对齐项目缩进、命名风格与 Rust Idiomatic 写法。
- **约束**：禁止任何逻辑发散，不准添加指令之外的“健壮性”代码。

---

## 3. 协作流图示
[Reasoning] -> (更新状态总线)
|
V
[Coder Phase I] -> (产出实施规格书)
|
V -- [清空无关上下文] --
|
[Coder Phase II] -> (生成干净 Diff)
|
V
[User Audit] -> (cargo check / 应用)